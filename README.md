## 隐私政策

 - 上海信息技术学校以下简称学校、沪信技校，共青团上海信息技术学校委员会简称校团委，上海信息技术学校团委学生会简称校团委学生会，上海信息技术学校团委学生会生活部以下简称本部门、部门、团委学生会生活部，上海信息技术学校团委学生会生活部部员以下简称部员，该系统下的所有账户都称为用户，原则上一个账户主体只对应同一个人，除非有额外用途例如系统维护。
 - 在默认情况下，使用本系统的用户均年满14周岁，未满14周岁不应使用本系统。
 - 本项目不属于学校智慧校园的任何部分，不使用校园服务器，认证系统不依赖学校CAS认证或802.1x认证系统，与学校的智慧校园网络（*.shitac.net）无关，仅作为校园网络中的团委学生会的个人计算机接入设备。
 - 本项目的数据存储位置位于本部门工位上的个人电脑，其数据除了服务端和客户端，不会在其他任何位置落地，工位地址：上海市普陀区真南路1008号7号楼201室外围靠窗左侧第二座。
 - 本项目中使用的部门私有个人网盘（用于请假管理证明图片用途）系免费的国际版Microsoft365 Sharepoint，存储位置位于新加坡，我们会明确告知用户禁止传输任何个人敏感信息、华谊集团或学校决策机密、国家秘密，严重者可能触犯《中华人民共和国刑法》等情形。如果用户明确拒绝使用此网盘，用户可在进行请假功能时事先使用“事假”类型绕过图片上传，再和管理员联系，说明具体事由，由管理员更改类型并进行审批，明确拒绝使用此网盘的用户向管理员提供的照片，管理员不得对有关照片的任何部分补充上传到部门私有个人网盘。
 - 本项目所涉硬件设备、口令、密钥由部门内专人专员管理，定期更换密钥或口令。
 - 需要调用“智慧信校”、“智慧校园”的功能严格按照其服务器的要求进行认证，不会对相关管控措施进行破解或破坏。
 - 关于本项目内部的信息传输、数据安全的第一责任人为本部门在校团委学生会登记在册的在任干部（部长、副部长）。
 - 本项目所涉的学校网盘内部资源，由团委书记授权下向本部门经校学生会登记在册的部长或副部长提供智慧信校团委专用账户，按照有关规定，他们不能向其他任何人透露账户密码，所以本项目有关网盘管理的部分的作用就是细分权限，且在不透露账户密码的情况下，根据部门业务需求进行操作。
 - 所有使用本项目的用户仅允许为经校团委学生会登记的在册在任的生活部成员或为学校聘请的且为在任期间的与业务相关的教师。所有有效用户都是本部门经校学生会登记在册的部长或副部长授权的情况下，在用户角色权限内有限的访问学校网盘内部资源，且不提供主动下载功能。
 - 该项目处理个人信息过程中严格遵守《中华人民共和国个人信息保护法》、《中华人民共和国数据安全法》、《中华人民共和国网络安全法》、《未成年人保护法》、《教育部等六部门关于规范教育移动互联网应用有序健康发展的意见》（教技函〔2019〕55号）：
   1. 不存储包括但不限于人脸头像、生物识别、身份证件、宗教信仰、任何家庭成员个人信息、家庭或户籍住址、金融账户或财产信息、行踪轨迹等可以明确指向个人的敏感信息。
   2. 对数据分类分级保护，细分到角色。
   3. 严格保护个人信息，对相关设施、软件、网络链路采取强加密措施（如强制SSL链路、加密存储信息、根据角色和需求访问相关个人信息）。
   4. 用户密码使用不可逆的bcrypt算法加密存储，即使数据库中的用户密码遭到窃取或发生泄露也不存在使用本部门密码、手机，对用户其它服务进行撞库攻击的可能。
   5. 手机号使用AES加密存储，即使数据库直接遭到窃取或发生泄漏，也不存在使用本部门密码、手机，对用户其它服务进行撞库攻击的可能。
   6. 采取信息收集最小化原则，仅收集与部门运行直接的相关信息：行政班级、行政系部、姓名、性别、政治面貌（用于团委或部门组织建设、机会激励）、是否住宿（用于值班排班参考）、用于联系的手机号码、部门内部职务、部门内部值班班次，以上信息均由用户在校团委学生会纳新时提供或根据部员职责要求，在部门大会上对个人信息进行维护提供、教师自愿提供个人的相关信息，如果用户为部门部员自始至终都不同意提供相关信息，是不可能会被正常纳新进入部门的。
   7. 所有API的访问都会保存在审计记录中，且至少保留2年。
   8. 用户发生退部、转部、离岗等情形账户将会封禁（软删除）；用户发生毕业、转学、退学、开除以上四个情形账户永久删除不可恢复、所有个人信息从服务器中抹除。
 - 本项目如有违反国家、地方政策或学校有关数据安全、网络安全的规定，将优先在协商、整改期限内以解决问题的方式进行合规改造。
 - 根据 沪信技校办〔2023) 64号 关于印发《上海信息技术学校学生会章程》的通知 设立职务的概念以及相关功能。
 - 截止2024-2025学年第二学期 上海信息技术学校团委学生会 实际运行规则与情况进行相关功能实际开发，将持续维护该项目，直到在本页面宣布停止更新。

## 使用概念

### 职务与角色

- 部长（校团委学生会登记在册的在任干部）

- 副部长（校团委学生会登记在册的在任干部）

- 部门负责人（部门内部锻炼岗，培养部门未来的接班人）

  以上角色在文档的功能列表中以“高级-”开头。

  1. 具有除用户增删改查、安全访问审计、批量操作功能以外功能的所有权限。

  2. 可以查看部门根文件夹。
  3. 删除文件夹。
  4. 值班排班、请假审批。
  5. 修改本学期信息。
  6. 修改、删除、情况网盘文件夹模板

- 汇总负责人（部门内部职务，负责每日评分统计汇总分管当值部员）

- 实习汇总负责人（部门内部职务，在其他汇总负责人或部长、副部长帮助下展开工作，在合适时间转正或停止成为汇总负责人）

  以上角色在文档的功能列表中以“中级-”开头

  1. 可查看学期文件夹。

  2. 创建月份文件夹。
  3. 推送文件夹到私人微信传输助手。
  4. 增加网盘文件夹模板

- 普通部员（无部门内部职务，仅为校团委学生会登记在册的在任部员）

- 实习部员（经校团委学生会纳新，在实习期内的部员）

- 其他人员（不是校团委学生会登记在册的在任部员，退部、辞退、毕业人员、指导教师、非部员的技术支持人员）

  以上角色

  1. 可查看本月内的文件夹。

  2. 获取文件共享当天23:59截止的任意权限的链接。
  3. 签到、请假。
  4. 查看、下载网盘文件夹模板
  5. 查看当前学期信息
  6. 查看排版值班表

### 管理员

- 任何职务都可以设置为管理员
- 管理员权限的作用是对用户进行管理、安全访问审计、对系统运行具有运维能力
- 具有管理员权限的人员可以拥有本系统操作的所有权限
- 具有批量操作功能
- 在文档的功能列表中以“管理-”开头

### 内网环境

- 专业意义上指的是IP地址CIDR段为192.168.0.0/16、10.0.0.0/8、172.16.0.0/12，且直接连接服务器的Nginx反向代理服务。
- 使用意义上，在校团委部门工位电脑上的环境一定是内网环境。

## 使用说明

### 登录与认证

### 学期（网盘相关）

#### 	查看学期

#### 	高级-修改学期配置

### 模板（网盘相关）

#### 	列出模板

#### 	下载已有模板

#### 中级-添加模板

#### 高级-删除模板

#### 高级-清空模板

#### 高级-添加模板

#### 高级-修改模板

### 用户

#### 	用户个人资料

#### 	修改自己的密码

#### 	高级-列出用户

#### 	管理-用户添加

#### 	管理-用户修改

#### 	管理-用户删除

#### 	管理-用户恢复

#### 	管理-用户备份与下载

#### 	管理-用户批量上传

#### 	管理-重置密码

### 网盘管理

#### 	返回角色根目录

#### 	生成当前月文件夹

#### 	高级-生成学期文件夹

#### 	高级-生成某月文件夹

#### 	高级-返回上一级

#### 	中级-尝试推送

#### 	中级-删除文件夹

#### 	获取链接

#### 	删除文件

### 值班排班

####	查看值班

####	高级-添加值班计划

####	高级-批量排班

####	高级-删除值班

####	高级-查看值班计划

#### 	高级-编辑值班

####	高级-单独排班

####	高级-查看值班计划列表

####	高级-查看签到状态

####	高级-签到控制

####	高级-删除子签到

####	高级-补签

####	高级-驳回

####	高级-下载签到流水

####	高级-下载值班签到流水

####	高级-下载单个签到流水

####	管理-批量添加值班计划

### 签到

####	查看签到列表

####	签到

### 请假与审批

#### 	请假

#### 	高级-请假审批

####	高级-补充请假

### 数据统计

####	高级-用户数据统计

####	高级-考勤信息统计




## 安装与迁移



## Restful API说明

本项目使用 OpenAPI 3.0 规范定义接口，完整的接口规范请查看 ```config/SITC-Life-Driver.openai.json```

## 项目安全

### 系统安全加固措施一览表

本系统采用“零成本 + 零信任 + 分层防御”理念设计，以确保在服务商可能不可信、外部环境可能受污染的前提下，最大限度保障业务与数据安全。

| 分类 | 措施 | 说明与意义 |
|------|------|-------------|
| ☁️ 服务架构 | Nginx 反向代理 Flask 应用 | 限定后端仅监听本地端口，避免直接暴露 |
| 🔐 HTTPS 安全 | 不信任服务商提供的 HTTPS 证书 | 数据层使用双向 RSA + AES 加密，避免被 Cloudflare 层劫持窃听 |
| 🔑 登录与身份认证 | 用户登录仅明文账号密码，传输基于 HTTPS | 仅登录流程依赖 TLS 保障；登录后数据全部加密 |
| 🔐 前端密钥交换 | 前端使用 RSA 公钥加密 AES 密钥 | 后端解密后缓存 AES 密钥，绑定当前 Refresh Token 有效期 |
| 🔐 数据加密传输 | 前端使用 AES 加密核心数据后再传输 | 即使 HTTPS 被监听也无法获取明文内容 |
| 🔄 AES Key 更新机制 | AES Key 随 Refresh Token 自动轮转 | Refresh Token 有效期为 30 分钟，定期换密钥限制攻击窗口 |
| 🧠 AES Key 存储策略 | 存储于 localStorage，避免频繁请求密钥 | 依赖 XSS 防护保证其安全性，节省前端计算资源 |
| 📦 文件加密下载 | 管理员下载敏感数据前先 zip 并设定 UUID 密码 | 即使文件泄露，也需爆破 UUID，提升攻击成本 |
| ✅ 请求身份认证 | 所有非登录路由需携带 JWT Token | 并区分管理员/部门等权限，最小化授权面 |
| 🛡️ 内网接口控制 | 内部 API 基于 IP + HMAC 校验请求来源 | Nginx 通过 Lua 动态生成签名，Flask 验证签名一致性 |
| 🔐 Cloudflare Worker 上传 | Worker 专用 HMAC 校验（IP + 密钥） | 验证上传行为是否由可信 Worker 发起 |
| 🧼 输入过滤器 | Cerberus + 自定义清洗过滤器 | 拦截 XML 标签、SQL 注释符等危险符号 |
| 📜 SQL 注入防御 | 所有输入字段类型验证 + ORM 查询封装 | 不允许直接 SQL 拼接；无注入风险接口 |
| 📊 CSV 上传检查 | 单元格级别检查公式/XSS/注入字符 | 防止 CSV 注入等漏洞从办公软件触发攻击 |
| ⚙️ 后端执行安全 | 未启用 `exec`、`eval`、`globals()` 等高危函数 | 保证后端逻辑无法被动态注入执行 |
| 📁 文件访问控制 | Nginx 拒绝访问 `.env`、`.py`、`.php` 等文件 | 防止敏感文件被误暴露 |
| 👮 日志审计机制 | 成功操作基于 JWT 自动记录历史 | 审计日志支持回溯关键行为，排除预检请求 |
| 👥 用户权限划分 | `@admin_required`、`@position_required` 等装饰器 | 路由访问粒度控制，拒绝越权行为 |
| 🔥 防火墙与端口控制 | `iptables` 仅开放 22 和 443 端口 | 所有服务均限制本地访问，减少暴露面 |
| 🧾 数据库安全 | MySQL8 强制 SSL，仅允许 localhost 连接 | 使用专用账户与强口令，不暴露管理权限 |

> ✅ 本系统设计理念：数据保护不依赖任何外部服务商信任，端到端自控密钥，动态身份鉴权 + 最小权限设计。

# 🔐 AES 密钥协商流程图

为实现前后端数据链路的双重加密，系统采用前端生成 AES 密钥，使用 RSA 公钥加密后传输至后端的方式进行“密钥协商”，确保即使 HTTPS 层遭监听也无法泄露业务敏感数据。

---

### 📌 协议概述

- 前端负责：
  - 生成随机 AES 密钥（例如 32 字节）
  - 使用服务器提供的 RSA 公钥加密该密钥
  - 将密文在登录成功后随 Token 一并发送至后端

- 后端负责：
  - 使用 RSA 私钥解密出原始 AES 密钥
  - 将该密钥与当前 JWT Token 绑定，缓存于服务端
  - 所有后续数据加解密都使用该 AES 密钥完成

---

#### 🔁 协商流程图

```text
┌─────────────┐
│   前端浏览器 │
└────┬────────┘
     │
     │ ① 生成 AES 随机密钥（aes_key）
     ▼
┌─────────────┐
│RSA 公钥加密  │◄──────────────┐
│encrypt(aes_key)│             │
└────┬────────┘              │
     │                       │
     │ ② 登录成功后发送：     │
     │   - JWT AccessToken    │
     │   - 加密的 AES 密钥    │
     │                       │
     ▼                       │
┌──────────────────────────┐ │
│        后端服务器         │ │
├──────────────────────────┤ │
│③ 使用 RSA 私钥解密        │ │
│   decrypt(encrypted_key) → aes_key │
│④ 将 aes_key 与用户 Token 绑定   │
│⑤ 后续所有接口请求中       │
│   - 明文数据需用 aes_key 加密 │
└──────────────────────────┘
```


### 安全加固 ToDo 任务清单

以下是为保障本系统在长期运行中的数据安全、用户身份安全、链路信任最小化而设定的安全强化任务列表，建议按优先级依序完成。

| ✅ 状态 | 优先级 | 分类 | 任务名称 | 说明 |
|--------|-----|------|-----------|------|
| ✅ 已完成 | 高   | 身份鉴权 | JWT 权限中间件 | 所有敏感接口强制鉴权，基于角色控制访问 |
| ✅ 已完成 | 高   | 网络传输 | AES + RSA 双向加密 | 用户端生成 AESKey 用 RSA 公钥加密传输，保护应用层数据 |
| ✅ 已完成 | 中   | 数据脱敏 | 敏感文件 zip + uuid 密码保护 | 管理员下载数据包时使用 zip 打包并设置密码，降低二次泄露风险 |
| ✅ 已完成 | 高   | 接口过滤 | Cerberus + XSS/SQL 注入字符过滤 | 所有字段类型校验 + 注入危险字符过滤 |
| ✅ 已完成 | 高   | 内网接口保护 | IP + HMAC 校验（Nginx Lua） | 内网访问需 HMAC 签名，防止外部伪造请求 |
| ✅ 已完成 | 中   | 上传校验 | CSV 单元格级注入检测 | 防止通过 Excel 公式/XSS 注入内容 |
| ⏳ 待实现 | 高   | 防爆破机制 | 登录限速控制 | 使用 Flask-Limiter 限制每 IP 每用户每分钟最多尝试次数 |
| ⏳ 待实现 | 高   | 图形验证码 | 登录时加入滑动或图片验证码 | 拦截机器人自动化登录脚本 |
| ⏳ 待实现 | 中   | 邮箱验证码 | 可疑登录行为要求输入邮箱验证码 | 提高账号使用环境可信度 |
| ❌ 未计划 | 中   | MFA 双因子认证 | 高权限用户（如管理员）需绑定 TOTP 验证器 | 增加账户被撞库后的登录安全层 |
| ❌ 未计划 | 低   | Bandit 扫描集成 | 使用 Bandit 等静态分析工具扫描漏洞 | 定期 CI 安全检查，防止引入危险函数或泄密信息 |

> ✅ 状态说明：  
> - ✅ 已完成：已在生产环境启用  
> - ⏳ 待实现：功能已规划，待开发/测试/上线  
> - ❌ 未计划：暂无纳入计划
